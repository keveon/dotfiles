#!/usr/bin/env zsh

#MISE description="初始化 Bat, 安装 Zsh 自动补全"

if command -v bat >/dev/null 2>&1; then
  {{- if eq .chezmoi.os "darwin" }}
  # macOS 上 brew 安装的 bat 会自动配置补全
  if command -v brew >/dev/null 2>&1 && brew list bat >/dev/null 2>&1; then
    echo "Bat 通过 Homebrew 安装，补全已自动配置"
  fi

  {{- else if eq .chezmoi.os "linux" }}
  # Linux 系统 - 安装到用户目录
  COMPLETION_DIR="{{ .chezmoi.homeDir }}/.local/share/zsh/site-functions"
  mkdir -p "$COMPLETION_DIR"

  if bat --completion zsh 2>/dev/null > "${COMPLETION_DIR}/_bat"; then
      echo "Bat Zsh 自动补全已安装到: ${COMPLETION_DIR}/_bat"
      echo "注意: .zshenv 已配置 fpath, 补全会自动生效"
  else
      echo "警告: 无法安装 Bat 自动补全"
  fi

  unset COMPLETION_DIR
  {{- end }}
fi