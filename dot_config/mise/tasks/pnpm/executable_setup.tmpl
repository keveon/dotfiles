#!/usr/bin/env zsh

#MISE description="初始化 PNPM, 安装 Zsh 自动补全"

if command -v pnpm >/dev/null 2>&1; then
    # 安装 zsh 自动补全到用户目录
    COMPLETION_DIR="{{ .chezmoi.homeDir }}/.local/share/zsh/site-functions"
    mkdir -p "$COMPLETION_DIR"

    if pnpm completion zsh 2>/dev/null > "${COMPLETION_DIR}/_pnpm"; then
        echo "PNPM Zsh 自动补全已安装到: ${COMPLETION_DIR}/_pnpm"
        echo "注意: .zshenv 已配置 fpath, 补全会自动生效"
    else
        echo "警告: 无法安装 PNPM 自动补全"
    fi

    unset COMPLETION_DIR
fi