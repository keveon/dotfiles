#!/usr/bin/env zsh

#MISE description="初始化 Eza, 安装 Zsh 自动补全"

if command -v eza >/dev/null 2>&1; then
  {{- if eq .chezmoi.os "darwin" }}
  # macOS 上 brew 安装的 eza 会自动配置补全
  if command -v brew >/dev/null 2>&1 && brew list eza >/dev/null 2>&1; then
    echo "Eza 通过 Homebrew 安装，补全已自动配置"
  fi

  {{- else if eq .chezmoi.os "linux" }}
  # Linux 系统 - eza 没有内置补全生成命令
  # 使用社区提供的补全脚本
  COMPLETION_DIR="{{ .chezmoi.homeDir }}/.local/share/zsh/site-functions"
  mkdir -p "$COMPLETION_DIR"

  if command -v curl >/dev/null 2>&1; then
    if curl -fsSL https://raw.githubusercontent.com/z-shell/zsh-eza/main/completions/_eza -o "${COMPLETION_DIR}/_eza" 2>/dev/null; then
      echo "Eza Zsh 自动补全已安装到: ${COMPLETION_DIR}/_eza"
      echo "注意: .zshenv 已配置 fpath, 补全会自动生效"
    else
      echo "警告: 无法下载 Eza 自动补全"
      echo "可以考虑使用 zsh-eza 插件: https://github.com/z-shell/zsh-eza"
    fi
  else
    echo "警告: curl 未安装，无法下载 Eza 补全"
  fi

  unset COMPLETION_DIR
  {{- end }}
fi